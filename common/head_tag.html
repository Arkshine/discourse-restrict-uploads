<script type="text/discourse-plugin" version="0.8.25">
  const { authorizesOneOrMoreExtensions } = require("discourse/lib/utilities");
  const computed = require("ember-addons/ember-computed-decorators").default;
  let currentUser = api.getCurrentUser();
  let canUpload;

  if(currentUser) {
    canUpload = currentUser.trust_level >= settings.restrict_to_trust_level || currentUser.staff;
  }

  api.modifyClass('controller:composer', {
    allowUpload: Ember.computed(function() {
      if(canUpload && authorizesOneOrMoreExtensions()) {
        return true;
      }
    })
  });

  api.modifyClass('component:composer-editor', {
    _bindUploadTarget: function() {
      if(canUpload) {
        this._super();
      }
    },
    @computed("composer.requiredCategoryMissing")
    replyPlaceholder(requiredCategoryMissing) {
      if(canUpload) {
        return this._super();
      } else {
        return "composer.reply_placeholder_no_images";
      }
    }
  });
</script>